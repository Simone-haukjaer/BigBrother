<!--Big thanks to Claude AI for baisically making all of this-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Big Brother - Health Data</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Base styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f7f9fc;
      margin: 0;
      padding: 20px;
    }
    
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #3498db;
    }
    
    /* Container styles */
    .container {
      display: flex;
      flex-direction: column;
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 25px;
    }
    
    .content-row {
      display: flex;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    /* Risk matrix styles */
    .risk-matrix {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .risk-matrix text {
      font-size: 13px;
    }
    
    .risk-matrix .title {
      font-size: 18px;
      font-weight: bold;
    }
    
    .risk-cell {
      transition: all 0.3s ease;
    }
    
    .risk-cell:hover {
      stroke: #000;
      stroke-width: 2px;
      filter: brightness(1.1);
    }
    
    .axis-label {
      font-size: 15px;
      font-weight: bold;
      fill: #2c3e50;
    }
    
    .person-marker {
      stroke: #000;
      stroke-width: 2px;
      filter: drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.3));
    }
    
    .average-marker {
      stroke: #000;
      stroke-width: 2px;
      stroke-dasharray: 3,3;
      filter: drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2));
    }
    
    /* Graph container styles */
    .graph-container {
      flex: 0 0 600px;
      position: relative;
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-right: 20px;
    }
    
    /* Analysis container styles */
    .analysis-container {
      flex: 1;
      padding: 25px;
      min-width: 300px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .analysis-container p {
      margin-bottom: 15px;
    }
    
    .analysis-container strong {
      color: #2c3e50;
    }
    
    /* Markers legend styles */
    .markers-legend {
      position: absolute;
      bottom: 15px;
      left: 25px; 
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      margin: 8px 0;
    }
    
    .legend-circle {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      margin-right: 10px;
      display: inline-block;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }
    
    /* Pie chart styles */
    .pie-container {
      margin: 0 auto 40px auto;
      width: 100%;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .pie-chart-title {
      font-size: 22px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 15px;
      color: #2c3e50;
    }
    
    #dna-pie-chart {
      display: flex;
      justify-content: center;
      width: 100%;
      height: 320px;
    }
    
    .pie-legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    
    .pie-legend-item {
      display: flex;
      align-items: center;
      margin: 8px 20px;
    }
    
    .pie-legend-color {
      width: 14px;
      height: 14px;
      margin-right: 8px;
      display: inline-block;
      border-radius: 3px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }
    
    .pie-tooltip {
      position: absolute;
      padding: 10px;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid #ddd;
      border-radius: 6px;
      pointer-events: none;
      font-size: 13px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    
    /* Utility styles */
    .loading {
      font-size: 18px;
      text-align: center;
      padding: 25px;
      color: #7f8c8d;
    }
    
    .error {
      color: #e74c3c;
      font-size: 16px;
      text-align: center;
      padding: 20px;
      background: #fef2f2;
      border-radius: 5px;
    }
    
    .back-button {
      margin: 25px auto;
      padding: 10px 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
      display: block;
    }
    
    .back-button:hover {
      background-color: #2980b9;
    }
    
    /* Chart type switcher styles */
    .chart-switcher {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .chart-button {
      padding: 8px 20px;
      margin: 0 10px;
      background-color: #e0e0e0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .chart-button.active {
      background-color: #3498db;
      color: white;
    }
    
    .chart-button:hover {
      background-color: #2980b9;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Your Risk Analysis</h1>
  <div class="container">
    <!-- Chart library switcher -->
    <div class="chart-switcher">
      <button id="d3-button" class="chart-button active">D3.js Charts</button>
      <button id="chartjs-button" class="chart-button">Chart.js Charts</button>
    </div>
    
    <!-- DNA Uniqueness Pie Chart Container -->
    <div class="pie-container">
      <div class="pie-chart-title">DNA Uniqueness Profile</div>
      <div id="dna-pie-chart"></div>
      <div class="pie-legend" id="dna-pie-legend"></div>
    </div>
    
    <div class="content-row">
      <div class="graph-container" id="risk-matrix-container">
        <div class="loading">Loading your risk data...</div>
      </div>
      
      <div class="analysis-container" id="risk-analysis">
        <p><strong>Risk Analysis:</strong> Loading...</p>
      </div>
    </div>
  </div>
  
  <button class="back-button" onclick="window.location.href='index.html'">Back to Data View</button>

  <!-- Load required libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script type="module">
    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

    // Sample data for fallback
    const samplePersonData = {
      name: "John Doe",
      age: 45,
      gender: "Male",
      bmi: 26.4,
      blood_type: "O+",
      smoker: false,
      health_risks: {
        alzheimer_risk: 0.35
      },
      dna_uniqueness: {
        common: 0.65,
        unusual: 0.25,
        rare: 0.10
      }
    };

    const sampleGeneralData = {
      genetic_risk_averages: {
        alzheimer_risk: 0.25
      },
      average_bmi: 24.5
    };

    let currentChartLibrary = 'd3';
    let personData = samplePersonData;
    let generalData = sampleGeneralData;
    
    // Try to fetch data, but use sample data as fallback
    try {
      Promise.all([
        fetch("data/persondata.json").then(res => res.json()),
        fetch("data/generaldata.json").then(res => res.json())
      ])
      .then(([fetchedPersonData, fetchedGeneralData]) => {
        personData = fetchedPersonData;
        generalData = fetchedGeneralData;
        
        // Remove loading message
        document.querySelector(".loading").remove();
        
        // Initialize the current library's charts
        renderCurrentCharts();
        
        // Update analysis text
        updateAnalysis(personData, generalData);
      })
      .catch(err => {
        console.warn("Using sample data due to fetch error:", err.message);
        document.querySelector(".loading").remove();
        
        // Use sample data instead
        renderCurrentCharts();
        updateAnalysis(personData, generalData);
      });
    } catch (err) {
      console.warn("Using sample data due to error:", err.message);
      document.querySelector(".loading").remove();
      
      // Use sample data as fallback
      renderCurrentCharts();
      updateAnalysis(personData, generalData);
    }

    // Function to update the analysis text
    function updateAnalysis(personData, generalData) {
      const personRisk = personData.health_risks.alzheimer_risk;
      const averageRisk = generalData.genetic_risk_averages.alzheimer_risk;
      const riskDifference = ((personRisk - averageRisk) / averageRisk * 100).toFixed(0);
      
      let riskLevel, riskColor;
      if (personRisk < 0.2) {
        riskLevel = "low";
        riskColor = "#4CAF50"; // Green
      } else if (personRisk < 0.6) {
        riskLevel = "moderate";
        riskColor = "#FFC107"; // Yellow
      } else {
        riskLevel = "high";
        riskColor = "#F44336"; // Red
      }
      
      const analysisHtml = `
        <h3 style="color: #2c3e50; border-bottom: 1px solid #eee; padding-bottom: 10px;">Risk Analysis</h3>
        <p>This risk matrix shows your Alzheimer's risk (blue circle) 
        compared to the population average (gray circle). The x-axis represents likelihood, while the y-axis 
        represents impact. The color gradient from green to yellow to red indicates increasing risk levels.</p>
        
        <h3 style="color: #2c3e50; border-bottom: 1px solid #eee; padding-bottom: 10px;">Interpretation</h3>
        <p>Your Alzheimer's risk (<span style="font-weight: bold;">${(personRisk * 100).toFixed(1)}%</span>) 
        is <span style="font-weight: bold; color: ${riskDifference > 0 ? '#F44336' : '#4CAF50'}">${riskDifference}% ${riskDifference > 0 ? 'higher' : 'lower'}</span> than the population average (${(averageRisk * 100).toFixed(1)}%). 
        Your risk falls in the <span style="font-weight: bold; color: ${riskColor};">${riskLevel}</span> range.</p>
        
        <h3 style="color: #2c3e50; border-bottom: 1px solid #eee; padding-bottom: 10px;">Risk Factors</h3>
        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div><strong>Age:</strong> ${personData.age} years old</div>
            <div><strong>Gender:</strong> ${personData.gender}</div>
            <div><strong>BMI:</strong> ${personData.bmi} (avg: ${generalData.average_bmi})</div>
            <div><strong>Blood Type:</strong> ${personData.blood_type}</div>
            <div><strong>Smoker:</strong> ${personData.smoker ? "Yes" : "No"}</div>
          </div>
        </div>
      `;
      
      document.getElementById("risk-analysis").innerHTML = analysisHtml;
    }
    
    // Function to render the current selected chart library
    function renderCurrentCharts() {
      // First, clear existing charts
      clearCharts();
      
      if (currentChartLibrary === 'd3') {
        // Import and use D3 module
        import('./d3-charts.js').then(module => {
          module.createDnaPieChart(personData, d3);
          module.createRiskMatrix(personData, generalData, d3);
        }).catch(err => {
          console.error("Error loading D3 charts module:", err);
          document.getElementById("dna-pie-chart").innerHTML = `<div class="error">Error loading D3 charts</div>`;
        });
      } else {
        // Import and use Chart.js module
        import('./chartjs-charts.js').then(module => {
          module.createDnaPieChart(personData);
          module.createRiskMatrix(personData, generalData);
        }).catch(err => {
          console.error("Error loading Chart.js charts module:", err);
          document.getElementById("dna-pie-chart").innerHTML = `<div class="error">Error loading Chart.js charts</div>`;
        });
      }
    }
    
    // Function to clear existing charts
    function clearCharts() {
      document.getElementById("dna-pie-chart").innerHTML = "";
      document.getElementById("dna-pie-legend").innerHTML = "";
      
      // Clear risk matrix container
      const riskContainer = document.getElementById("risk-matrix-container");
      // Keep any non-SVG elements (like the loading message)
      const nonSvgElements = Array.from(riskContainer.querySelectorAll(":not(svg)"));
      riskContainer.innerHTML = "";
      nonSvgElements.forEach(el => riskContainer.appendChild(el));
    }
    
    // Set up event listeners for chart type switching
    document.getElementById("d3-button").addEventListener("click", function() {
      if (currentChartLibrary !== 'd3') {
        currentChartLibrary = 'd3';
        updateActiveButton();
        renderCurrentCharts();
      }
    });
    
    document.getElementById("chartjs-button").addEventListener("click", function() {
      if (currentChartLibrary !== 'chartjs') {
        currentChartLibrary = 'chartjs';
        updateActiveButton();
        renderCurrentCharts();
      }
    });
    
    // Update active button styling
    function updateActiveButton() {
      document.getElementById("d3-button").classList.toggle("active", currentChartLibrary === 'd3');
      document.getElementById("chartjs-button").classList.toggle("active", currentChartLibrary === 'chartjs');
    }
  </script>
</body>
</html>